# 一、方案简介及技术路线

### Step 1: 题目分类

1. 提取公司名称(get_company):提取招股说明书首尾信息，利用大模型获得公司名称
2. 分类(question_cls):取公司名称的前四个字，若问题中含有以上公司名称，则添加字段"type" q"["type"]=0,为知识库查询题目，其他为数据库查询题目

### Step 2: 知识库查询题目

1. Global 知识库创建：将 80 篇招股说明书进行切片(metadata 为文件名)，创建 1 个全局知识库;
2. Local 知识库创建:对每篇招股说明书进行切片,独立创建知识库,总计 80 个局部知识库,知识库的索引为文件名;
3. 知识库查询:① 将问题（XX 公司的股东为？）切分为公司名称（XX 公司）和具体问题（公司的股东为？）② 使用公司名称（XX 公司）作为 Query1 从 Global 知识库中查询得到相似度最高的文章切片,从 metadata 中得到文件名,③ 通过文件名得到索引，将具体问题（公司的股东为？）作为 Query2 查询 Local 知识库,返回 TopK 文档,结合模板生成 prompt,输入大模型得到答案.

### Step 3: 数据查询题处理

1. 选择数据表(select_tables):通过提供问题和全部数据表信息,让大模型判断从哪些表中获得答案;
2. SQL 生成(generate_sql): ① 挑选部分数据集样例，人工构造 NL2SQL 的数据集约 400 条，通过 LoRA 微调 Tongyi-Finance-14B-Chat 模型 ② 基于规则选择不同的 PROMPT 模板,每个模板提供 few-shot examples,输入大模型得到 SQL;
3. 执行 SQL 语句(exec_sql):调用 SQLDataBase 库，进行数据库查询；
4. 获得答案(get_answer):① 为保证输出正确格式的答案，同样构造少部分微调数据集，通过 LoRA 微调 Tongyi-Finance-14B-Chat 模型 ② 将答案与问题一同输入大模型，得到最终答案.

### Step 4: 整理数据

1. 通过 format_data 函数,得到可以提交的数据格式文件.

# 二、创新点

1. 知识库问答，通过问题切分并结合 Global 知识库和 Local 知识库，缩小召回文档范围，有效提高文档召回的准确率。
2. 数据库问答，利用 CoT 的思想,将复杂问题拆解,利用参数高效微调方法进一步优化基础模型,提升 NL2SQL 的准确率。
